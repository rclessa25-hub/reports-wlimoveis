name: üöÄ Gerar Relat√≥rio

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout projeto analisado
      uses: actions/checkout@v4
      with:
        repository: rclessa25-hub/imoveis-maceio
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: üìä Coletar estat√≠sticas
      id: stats
      run: |
        HTML=$(find . -name "*.html" | wc -l)
        CSS=$(find . -name "*.css" | wc -l)
        JS=$(find . -name "*.js" | wc -l)
        TOTAL=$((HTML + CSS + JS))
        DATE=$(date '+%d/%m/%Y %H:%M')
        
        echo "HTML=$HTML" >> $GITHUB_OUTPUT
        echo "CSS=$CSS" >> $GITHUB_OUTPUT
        echo "JS=$JS" >> $GITHUB_OUTPUT
        echo "TOTAL=$TOTAL" >> $GITHUB_OUTPUT
        echo "DATE=$DATE" >> $GITHUB_OUTPUT
        
        echo "üìä Estat√≠sticas:"
        echo "- HTML: $HTML"
        echo "- CSS: $CSS"
        echo "- JavaScript: $JS"
        echo "- Total: $TOTAL"
    
    - name: üìÅ Checkout reposit√≥rio de relat√≥rios
      uses: actions/checkout@v4
      with:
        path: './output'
    
    - name: üåê Criar relat√≥rio HTML
      run: |
        cd output
        
        # Criar index.html SIMPLES
        cat > index.html << HTML
        <!DOCTYPE html>
        <html>
        <head>
            <title>üìä Relat√≥rios - Im√≥veis Macei√≥</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                    max-width: 1000px;
                    margin: 0 auto;
                }
                header {
                    text-align: center;
                    margin-bottom: 40px;
                    padding-bottom: 20px;
                    border-bottom: 2px solid #2ea44f;
                }
                h1 { color: #2ea44f; }
                .stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px;
                    margin: 30px 0;
                }
                .stat-box {
                    border: 2px solid #2ea44f;
                    border-radius: 10px;
                    padding: 20px;
                    text-align: center;
                }
                .stat-number {
                    font-size: 2.5em;
                    color: #2ea44f;
                    font-weight: bold;
                }
                .btn {
                    display: inline-block;
                    background: #2ea44f;
                    color: white;
                    padding: 12px 24px;
                    text-decoration: none;
                    border-radius: 6px;
                    margin: 10px;
                }
            </style>
        </head>
        <body>
            <header>
                <h1>üìä Relat√≥rios T√©cnicos</h1>
                <p>Im√≥veis Macei√≥ - An√°lise de Projeto</p>
                <p>Gerado em: ${{ steps.stats.outputs.DATE }}</p>
            </header>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number">${{ steps.stats.outputs.HTML }}</div>
                    <div>Arquivos HTML</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${{ steps.stats.outputs.CSS }}</div>
                    <div>Estilos CSS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${{ steps.stats.outputs.JS }}</div>
                    <div>Scripts JavaScript</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${{ steps.stats.outputs.TOTAL }}</div>
                    <div>Total Arquivos</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 40px 0;">
                <a href="https://rclessa25-hub.github.io/imoveis-maceio/" class="btn" target="_blank">
                    üåê Acessar Site Principal
                </a>
                <a href="https://github.com/rclessa25-hub/imoveis-maceio" class="btn" target="_blank" style="background: #24292e;">
                    üíª Ver C√≥digo no GitHub
                </a>
            </div>
            
            <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center;">
                <p><strong>Sistema de Relat√≥rios Autom√°ticos</strong></p>
                <p>Atualizado via GitHub Actions | Acesso p√∫blico</p>
            </div>
        </body>
        </html>
        HTML
        
        echo "‚úÖ Relat√≥rio HTML criado"
    
    - name: üíæ Commit e push
      run: |
        cd output
        
        # Configurar git
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # Adicionar e commit
        git add .
        git commit -m "üìä Atualiza relat√≥rio [${{ steps.stats.outputs.DATE }}]" || echo "Sem mudan√ßas"
        git push || echo "Nada para push"
    
    - name: ‚úÖ Conclus√£o
      run: |
        echo ""
        echo "üéâ RELAT√ìRIO GERADO COM SUCESSO!"
        echo ""
        echo "üåê ACESSE EM:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìä ESTAT√çSTICAS:"
        echo "- HTML: ${{ steps.stats.outputs.HTML }} arquivos"
        echo "- CSS: ${{ steps.stats.outputs.CSS }} arquivos"
        echo "- JavaScript: ${{ steps.stats.outputs.JS }} arquivos"
        echo "- Total: ${{ steps.stats.outputs.TOTAL }} arquivos"
