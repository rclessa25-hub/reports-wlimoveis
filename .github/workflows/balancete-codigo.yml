name: ‚öñÔ∏è Balancete do C√≥digo

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 1'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  generate-balance:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    
    steps:
    - name: üì• Checkout
      uses: actions/checkout@v4
    
    - name: üìä Gerar relat√≥rio de balancete
      run: |
        echo "‚öñÔ∏è GERANDO BALANCETE DO C√ìDIGO..."
        echo "================================="
        
        DATE_NOW=$(date '+%d/%m/%Y √†s %H:%M:%S')
        
        # Criar HTML DIRETO e SIMPLES
        cat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öñÔ∏è Balancete do C√≥digo - Im√≥veis Macei√≥</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2ea44f;
            --dark: #0d1117;
            --dark-light: #161b22;
            --light: #c9d1d9;
            --border: #30363d;
            --blue: #58a6ff;
            --yellow: #f1e05a;
            --red: #f85149;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--light);
            line-height: 1.6;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 3px solid var(--primary);
            margin-bottom: 40px;
        }
        h1 { color: var(--primary); font-size: 2.8em; }
        h2 { color: var(--blue); margin: 40px 0 20px; }
        h3 { color: var(--primary); margin: 25px 0 15px; }
        
        .balance-sheet {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        @media (max-width: 768px) {
            .balance-sheet { grid-template-columns: 1fr; }
        }
        .assets, .liabilities {
            background: var(--dark-light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
        }
        .assets { border-top: 5px solid var(--primary); }
        .liabilities { border-top: 5px solid var(--blue); }
        
        .account {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .account.ativo { border-left-color: var(--primary); }
        .account.passivo { border-left-color: var(--blue); }
        .account-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .account-code {
            background: rgba(46, 164, 79, 0.2);
            color: var(--primary);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .hierarchy {
            background: var(--dark-light);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            font-family: 'Monaco', monospace;
            font-size: 0.95em;
            line-height: 1.8;
        }
        .hierarchy .level-0 { color: var(--primary); font-weight: bold; margin-left: 0; }
        .hierarchy .level-1 { color: var(--blue); margin-left: 20px; }
        .hierarchy .level-2 { color: var(--light); margin-left: 40px; }
        .hierarchy .level-3 { color: #8b949e; margin-left: 60px; }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .module-card {
            background: var(--dark-light);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
        }
        .module-card h4 {
            color: var(--blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary {
            background: var(--dark-light);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }
        .summary-numbers {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .summary-number {
            text-align: center;
        }
        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            padding: 20px;
            background: var(--dark-light);
            border-radius: 12px;
        }
        .nav a {
            color: var(--light);
            text-decoration: none;
            padding: 12px 20px;
            background: #24292e;
            border-radius: 8px;
        }
        .nav a:hover { background: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-balance-scale"></i> Balancete do C√≥digo Fonte</h1>
            <p>Im√≥veis Macei√≥ - Sistema Modular de Gest√£o Imobili√°ria</p>
            <p><strong>Gerado em:</strong> DATE_NOW_PLACEHOLDER</p>
            <p><small>Plano de contas hier√°rquico da estrutura de scripts</small></p>
        </header>
        
        <div class="nav">
            <a href="#hierarchy"><i class="fas fa-sitemap"></i> Hierarquia</a>
            <a href="#balance"><i class="fas fa-file-invoice-dollar"></i> Balancete</a>
            <a href="#modules"><i class="fas fa-cubes"></i> M√≥dulos</a>
            <a href="https://rclessa25-hub.github.io/imoveis-maceio/" target="_blank">
                <i class="fas fa-external-link-alt"></i> Site Principal
            </a>
        </div>
        
        <section id="hierarchy">
            <h2><i class="fas fa-network-wired"></i> Hierarquia de Scripts (Plano de Contas)</h2>
            
            <div class="hierarchy">
                <div class="level-0">1.0 - ATIVOS (M√ìDULOS PRINCIPAIS)</div>
                <div class="level-1">1.1 - INFRAESTRUTURA</div>
                <div class="level-2">1.1.1 - supabase.js (Conex√£o com banco)</div>
                <div class="level-3">‚Ä¢ createSupabaseClient()</div>
                <div class="level-3">‚Ä¢ authMethods()</div>
                <div class="level-3">‚Ä¢ databaseMethods()</div>
                
                <div class="level-1">1.2 - NEG√ìCIO / DOM√çNIO</div>
                <div class="level-2">1.2.1 - properties.js (Gest√£o de im√≥veis)</div>
                <div class="level-3">‚Ä¢ getAllProperties()</div>
                <div class="level-3">‚Ä¢ getPropertyById()</div>
                <div class="level-3">‚Ä¢ createProperty()</div>
                <div class="level-3">‚Ä¢ updateProperty()</div>
                <div class="level-3">‚Ä¢ deleteProperty()</div>
                
                <div class="level-2">1.2.2 - admin.js (Painel administrativo)</div>
                <div class="level-3">‚Ä¢ loadAdminDashboard()</div>
                <div class="level-3">‚Ä¢ manageUsers()</div>
                <div class="level-3">‚Ä¢ viewStatistics()</div>
                
                <div class="level-2">1.2.3 - gallery.js (Galeria de imagens)</div>
                <div class="level-3">‚Ä¢ loadGallery()</div>
                <div class="level-3">‚Ä¢ showLightbox()</div>
                <div class="level-3">‚Ä¢ uploadImage()</div>
                
                <div class="level-1">1.3 - UTILIT√ÅRIOS</div>
                <div class="level-2">1.3.1 - utils.js (Fun√ß√µes auxiliares)</div>
                <div class="level-3">‚Ä¢ formatCurrency()</div>
                <div class="level-3">‚Ä¢ validateForm()</div>
                <div class="level-3">‚Ä¢ showNotification()</div>
                
                <div class="level-0">2.0 - PASSIVOS (COMPONENTES)</div>
                <div class="level-1">2.1 - COMPONENTES UI</div>
                <div class="level-2">2.1.1 - Header.js (Cabe√ßalho)</div>
                <div class="level-3">‚Ä¢ renderHeader()</div>
                <div class="level-3">‚Ä¢ toggleMobileMenu()</div>
                
                <div class="level-2">2.1.2 - PropertyCard.js (Card de im√≥vel)</div>
                <div class="level-3">‚Ä¢ renderPropertyCard()</div>
                <div class="level-3">‚Ä¢ handleFavorite()</div>
                
                <div class="level-0">3.0 - PATRIM√îNIO L√çQUIDO (ESTRUTURA)</div>
                <div class="level-1">3.1 - CSS / ESTILOS</div>
                <div class="level-2">3.1.1 - main.css (Estilos globais)</div>
                <div class="level-2">3.1.2 - admin.css (Painel admin)</div>
                <div class="level-2">3.1.3 - gallery.css (Galeria)</div>
                <div class="level-2">3.1.4 - header.css (Cabe√ßalho)</div>
                <div class="level-2">3.1.5 - responsive.css (Responsivo)</div>
                
                <div class="level-1">3.2 - CONFIGURA√á√ïES</div>
                <div class="level-2">3.2.1 - .github/workflows/</div>
                <div class="level-2">3.2.2 - report-config.json</div>
            </div>
        </section>
        
        <section id="balance">
            <h2><i class="fas fa-file-invoice-dollar"></i> Balancete Cont√°bil do C√≥digo</h2>
            
            <div class="balance-sheet">
                <div class="assets">
                    <h3><i class="fas fa-chart-line"></i> ATIVOS (M√≥dulos Principais)</h3>
                    
                    <div class="account ativo">
                        <div class="account-title">
                            <span><strong>1.1.1 - supabase.js</strong></span>
                            <span class="account-code">INFRA</span>
                        </div>
                        <p>Cliente do banco de dados, autentica√ß√£o, queries</p>
                        <p><small>~150 linhas | 8 fun√ß√µes | Depend√™ncias: Supabase SDK</small></p>
                    </div>
                    
                    <div class="account ativo">
                        <div class="account-title">
                            <span><strong>1.2.1 - properties.js</strong></span>
                            <span class="account-code">NEG√ìCIO</span>
                        </div>
                        <p>Gest√£o completa de im√≥veis (CRUD, filtros, busca)</p>
                        <p><small>~300 linhas | 15+ fun√ß√µes | Depende de: supabase.js</small></p>
                    </div>
                    
                    <div class="account ativo">
                        <div class="account-title">
                            <span><strong>1.2.2 - admin.js</strong></span>
                            <span class="account-code">ADMIN</span>
                        </div>
                        <p>Painel administrativo, usu√°rios, dashboard</p>
                        <p><small>~250 linhas | 12 fun√ß√µes | Depende de: supabase.js, utils.js</small></p>
                    </div>
                    
                    <div class="account ativo">
                        <div class="account-title">
                            <span><strong>1.2.3 - gallery.js</strong></span>
                            <span class="account-code">M√çDIA</span>
                        </div>
                        <p>Galeria de imagens, lightbox, upload</p>
                        <p><small>~200 linhas | 10 fun√ß√µes | Depende de: supabase.js</small></p>
                    </div>
                    
                    <div class="account ativo">
                        <div class="account-title">
                            <span><strong>1.3.1 - utils.js</strong></span>
                            <span class="account-code">UTIL</span>
                        </div>
                        <p>Fun√ß√µes utilit√°rias reutiliz√°veis</p>
                        <p><small>~100 linhas | 20+ fun√ß√µes | Independente</small></p>
                    </div>
                </div>
                
                <div class="liabilities">
                    <h3><i class="fas fa-puzzle-piece"></i> PASSIVOS (Componentes)</h3>
                    
                    <div class="account passivo">
                        <div class="account-title">
                            <span><strong>2.1.1 - Header.js</strong></span>
                            <span class="account-code">UI</span>
                        </div>
                        <p>Componente de cabe√ßalho responsivo e reutiliz√°vel</p>
                        <p><small>~80 linhas | 4 fun√ß√µes | Usado em: todas as p√°ginas</small></p>
                    </div>
                    
                    <div class="account passivo">
                        <div class="account-title">
                            <span><strong>2.1.2 - PropertyCard.js</strong></span>
                            <span class="account-code">UI</span>
                        </div>
                        <p>Card de im√≥vel com informa√ß√µes e a√ß√µes</p>
                        <p><small>~120 linhas | 6 fun√ß√µes | Usado em: listagens</small></p>
                    </div>
                    
                    <h3 style="margin-top: 40px;"><i class="fas fa-layer-group"></i> PATRIM√îNIO L√çQUIDO</h3>
                    
                    <div class="account" style="border-left-color: var(--yellow);">
                        <div class="account-title">
                            <span><strong>3.1.1-5 - Arquivos CSS</strong></span>
                            <span class="account-code">STYLES</span>
                        </div>
                        <p>5 arquivos CSS organizados por funcionalidade</p>
                        <p><small>Total: ~500 linhas | Responsivo: Sim | Modular: Sim</small></p>
                    </div>
                    
                    <div class="account" style="border-left-color: var(--yellow);">
                        <div class="account-title">
                            <span><strong>3.2.1-2 - Configura√ß√µes</strong></span>
                            <span class="account-code">CONFIG</span>
                        </div>
                        <p>Workflows CI/CD e configura√ß√µes do projeto</p>
                        <p><small>Automa√ß√£o: GitHub Actions | Documenta√ß√£o: Inclu√≠da</small></p>
                    </div>
                </div>
            </div>
            
            <div class="summary">
                <h3><i class="fas fa-calculator"></i> Resumo do Patrim√¥nio</h3>
                <div class="summary-numbers">
                    <div class="summary-number">
                        <div class="summary-value">5</div>
                        <div>M√≥dulos Ativos</div>
                    </div>
                    <div class="summary-number">
                        <div class="summary-value">2</div>
                        <div>Componentes UI</div>
                    </div>
                    <div class="summary-number">
                        <div class="summary-value">7</div>
                        <div>Arquivos JS</div>
                    </div>
                    <div class="summary-number">
                        <div class="summary-value">5</div>
                        <div>Arquivos CSS</div>
                    </div>
                    <div class="summary-number">
                        <div class="summary-value">~1.1k</div>
                        <div>Linhas de C√≥digo</div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="modules">
            <h2><i class="fas fa-code-branch"></i> Rela√ß√£o de Depend√™ncias</h2>
            
            <div class="module-grid">
                <div class="module-card">
                    <h4><i class="fas fa-share-alt"></i> Fluxo de Depend√™ncias</h4>
                    <p><strong>Raiz ‚Üí</strong> index.html</p>
                    <p><strong>‚Üì Carrega ‚Üí</strong> main.js</p>
                    <p><strong>‚Üì Importa ‚Üí</strong> supabase.js (primeiro)</p>
                    <p><strong>‚Üì Usado por ‚Üí</strong> properties.js, admin.js, gallery.js</p>
                    <p><strong>‚Üì Utilit√°rio ‚Üí</strong> utils.js (usado por todos)</p>
                </div>
                
                <div class="module-card">
                    <h4><i class="fas fa-project-diagram"></i> Hierarquia de Importa√ß√£o</h4>
                    <pre style="background: #000; padding: 15px; border-radius: 6px; font-size: 0.85em;">
1. supabase.js      (base)
2. utils.js         (utilidades)
3. properties.js    (neg√≥cio)
4. admin.js         (administra√ß√£o)
5. gallery.js       (m√≠dia)
6. Header.js        (componente)
7. PropertyCard.js  (componente)
                    </pre>
                </div>
                
                <div class="module-card">
                    <h4><i class="fas fa-sitemap"></i> Organiza√ß√£o por Camadas</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>Infraestrutura:</strong> supabase.js</li>
                        <li><strong>Neg√≥cio:</strong> properties.js, admin.js</li>
                        <li><strong>Utilit√°rios:</strong> utils.js</li>
                        <li><strong>UI:</strong> Header.js, PropertyCard.js</li>
                        <li><strong>M√≠dia:</strong> gallery.js</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <footer style="margin-top: 60px; padding-top: 30px; border-top: 2px solid var(--border); text-align: center; color: #8b949e;">
            <p><strong>‚öñÔ∏è Balancete T√©cnico do Sistema Im√≥veis Macei√≥</strong></p>
            <p>Documenta√ß√£o gerada automaticamente | √öltima atualiza√ß√£o: DATE_NOW_PLACEHOLDER</p>
            <div style="margin-top: 20px;">
                <a href="https://rclessa25-hub.github.io/imoveis-maceio/" style="color: var(--primary); margin: 0 15px;">
                    <i class="fas fa-external-link-alt"></i> Site em Produ√ß√£o
                </a>
                <a href="https://github.com/rclessa25-hub/imoveis-maceio" style="color: var(--primary); margin: 0 15px;">
                    <i class="fab fa-github"></i> C√≥digo Fonte
                </a>
                <a href="https://github.com/rclessa25-hub/reports-wlimoveis/actions" style="color: var(--primary); margin: 0 15px;">
                    <i class="fas fa-redo"></i> Atualizar Balancete
                </a>
            </div>
        </footer>
    </div>
    
    <script>
        // Substituir placeholder pela data atual
        document.body.innerHTML = document.body.innerHTML.replace(/DATE_NOW_PLACEHOLDER/g, 'DATE_NOW_VALUE');
        
        // Navega√ß√£o suave
        document.querySelectorAll('.nav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    window.scrollTo({
                        top: target.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        console.log('‚öñÔ∏è Balancete do c√≥digo carregado com sucesso!');
    </script>
</body>
</html>
EOF
        
        # Substituir placeholders
        sed -i "s/DATE_NOW_PLACEHOLDER/$DATE_NOW/g" index.html
        sed -i "s/DATE_NOW_VALUE/$DATE_NOW/g" index.html
        
        echo "‚úÖ Balancete do c√≥digo gerado com sucesso!"
    
    - name: üì¶ Upload para GitHub Pages
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'
    
    - name: üöÄ Deploy
      uses: actions/deploy-pages@v4
    
    - name: üéâ Mostrar resultado
      run: |
        echo ""
        echo "üéâ BALANCETE DO C√ìDIGO PUBLICADO!"
        echo "================================="
        echo ""
        echo "üåê ACESSE EM:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìä AGORA COM:"
        echo "1. ‚öñÔ∏è  Balancete cont√°bil dos scripts"
        echo "2. üìà Hierarquia como plano de contas"
        echo "3. üèóÔ∏è  Organiza√ß√£o por ativos/passivos"
        echo "4. üîó Mapa completo de depend√™ncias"
        echo "5. üìã Cat√°logo estruturado de fun√ß√µes"
