name: üì• Extrair C√≥digo Fonte (Ver3)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  extract-code:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    
    steps:
    - name: üì• Checkout
      uses: actions/checkout@v4
    
    - name: üì• Clonar projeto
      run: |
        git clone https://github.com/rclessa25-hub/imoveis-maceio.git fonte-completo
    
    - name: üìù Criar relat√≥rio
      run: |
        echo "Iniciando cria√ß√£o do relat√≥rio..."
        
        # Data atual
        DATE_NOW=$(date '+%d/%m/%Y %H:%M:%S')
        
        # Criar arquivo HTML inicial
        echo '<!DOCTYPE html>' > index.html
        echo '<html lang="pt-BR">' >> index.html
        echo '<head>' >> index.html
        echo '<meta charset="UTF-8">' >> index.html
        echo '<meta name="viewport" content="width=device-width, initial-scale=1.0">' >> index.html
        echo '<title>C√≥digo Fonte Completo</title>' >> index.html
        echo '<style>' >> index.html
        echo 'body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }' >> index.html
        echo '.container { max-width: 1200px; margin: 0 auto; }' >> index.html
        echo 'header { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; }' >> index.html
        echo '.code-block { background: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }' >> index.html
        echo 'pre { margin: 0; font-family: monospace; overflow-x: auto; }' >> index.html
        echo '.line { margin: 2px 0; }' >> index.html
        echo '.num { color: #666; margin-right: 15px; }' >> index.html
        echo '</style>' >> index.html
        echo '</head>' >> index.html
        echo '<body>' >> index.html
        echo '<div class="container">' >> index.html
        
        # Cabe√ßalho
        echo '<header>' >> index.html
        echo '<h1>üì• C√≥digo Fonte COMPLETO</h1>' >> index.html
        echo '<p>Im√≥veis Macei√≥ - Extra√ß√£o completa</p>' >> index.html
        echo "<p>Gerado em: $DATE_NOW</p>" >> index.html
        echo '</header>' >> index.html
        
        # Contar estat√≠sticas
        echo "Calculando estat√≠sticas..."
        
        # Lista de arquivos
        echo '<h2>üìä Estat√≠sticas</h2>' >> index.html
        echo '<div class="code-block">' >> index.html
        
        # Procurar arquivos HTML
        html_files=$(find fonte-completo -name "*.html" -type f)
        html_count=$(echo "$html_files" | wc -l)
        
        # Procurar arquivos JS
        js_files=$(find fonte-completo -name "*.js" -type f)
        js_count=$(echo "$js_files" | wc -l)
        
        # Procurar arquivos CSS
        css_files=$(find fonte-completo -name "*.css" -type f)
        css_count=$(echo "$css_files" | wc -l)
        
        # Procurar arquivos JSON
        json_files=$(find fonte-completo -name "*.json" -type f)
        json_count=$(echo "$json_files" | wc -l)
        
        total_files=$((html_count + js_count + css_count + json_count))
        
        # Contar linhas totais
        total_lines=0
        
        for file in $html_files; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
          fi
        done
        
        for file in $js_files; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
          fi
        done
        
        for file in $css_files; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
          fi
        done
        
        for file in $json_files; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
          fi
        done
        
        echo "<p><strong>Total de linhas:</strong> $total_lines</p>" >> index.html
        echo "<p><strong>Total de arquivos:</strong> $total_files</p>" >> index.html
        echo "<p><strong>Arquivos HTML:</strong> $html_count</p>" >> index.html
        echo "<p><strong>Arquivos JavaScript:</strong> $js_count</p>" >> index.html
        echo "<p><strong>Arquivos CSS:</strong> $css_count</p>" >> index.html
        echo "<p><strong>Arquivos JSON:</strong> $json_count</p>" >> index.html
        echo '<p><strong>Status:</strong> ‚úÖ Completo - Todas as linhas extra√≠das</p>' >> index.html
        echo '</div>' >> index.html
        
        # Mostrar c√≥digo HTML
        if [ $html_count -gt 0 ]; then
          echo '<h2>üåê Arquivos HTML</h2>' >> index.html
          for file in $html_files; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              echo "<div class='code-block'>" >> index.html
              echo "<h3>$filename</h3>" >> index.html
              echo '<pre>' >> index.html
              
              line_num=1
              while IFS= read -r line; do
                # Escapar caracteres HTML
                line=$(echo "$line" | sed 's/&/\&amp;/g')
                line=$(echo "$line" | sed 's/</\&lt;/g')
                line=$(echo "$line" | sed 's/>/\&gt;/g')
                
                echo "<div class='line'><span class='num'>$line_num</span>$line</div>" >> index.html
                line_num=$((line_num + 1))
              done < "$file"
              
              echo '</pre>' >> index.html
              echo '</div>' >> index.html
            fi
          done
        fi
        
        # Mostrar c√≥digo JavaScript
        if [ $js_count -gt 0 ]; then
          echo '<h2>üìú Arquivos JavaScript</h2>' >> index.html
          for file in $js_files; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              echo "<div class='code-block'>" >> index.html
              echo "<h3>$filename</h3>" >> index.html
              echo '<pre>' >> index.html
              
              line_num=1
              while IFS= read -r line; do
                line=$(echo "$line" | sed 's/&/\&amp;/g')
                line=$(echo "$line" | sed 's/</\&lt;/g')
                line=$(echo "$line" | sed 's/>/\&gt;/g')
                
                echo "<div class='line'><span class='num'>$line_num</span>$line</div>" >> index.html
                line_num=$((line_num + 1))
              done < "$file"
              
              echo '</pre>' >> index.html
              echo '</div>' >> index.html
            fi
          done
        fi
        
        # Mostrar c√≥digo CSS
        if [ $css_count -gt 0 ]; then
          echo '<h2>üé® Arquivos CSS</h2>' >> index.html
          for file in $css_files; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              echo "<div class='code-block'>" >> index.html
              echo "<h3>$filename</h3>" >> index.html
              echo '<pre>' >> index.html
              
              line_num=1
              while IFS= read -r line; do
                line=$(echo "$line" | sed 's/&/\&amp;/g')
                line=$(echo "$line" | sed 's/</\&lt;/g')
                line=$(echo "$line" | sed 's/>/\&gt;/g')
                
                echo "<div class='line'><span class='num'>$line_num</span>$line</div>" >> index.html
                line_num=$((line_num + 1))
              done < "$file"
              
              echo '</pre>' >> index.html
              echo '</div>' >> index.html
            fi
          done
        fi
        
        # Mostrar c√≥digo JSON
        if [ $json_count -gt 0 ]; then
          echo '<h2>üìã Arquivos JSON</h2>' >> index.html
          for file in $json_files; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              echo "<div class='code-block'>" >> index.html
              echo "<h3>$filename</h3>" >> index.html
              echo '<pre>' >> index.html
              
              line_num=1
              while IFS= read -r line; do
                line=$(echo "$line" | sed 's/&/\&amp;/g')
                line=$(echo "$line" | sed 's/</\&lt;/g')
                line=$(echo "$line" | sed 's/>/\&gt;/g')
                
                echo "<div class='line'><span class='num'>$line_num</span>$line</div>" >> index.html
                line_num=$((line_num + 1))
              done < "$file"
              
              echo '</pre>' >> index.html
              echo '</div>' >> index.html
            fi
          done
        fi
        
        # Rodap√©
        echo '<div class="code-block" style="text-align: center;">' >> index.html
        echo '<h3>‚úÖ Extra√ß√£o Completa</h3>' >> index.html
        echo "<p>$total_lines linhas em $total_files arquivos</p>" >> index.html
        echo '<p>Todas as linhas foram extra√≠das sem limita√ß√µes</p>' >> index.html
        echo "<p>Gerado em: $DATE_NOW</p>" >> index.html
        echo '<p>' >> index.html
        echo '<a href="https://rclessa25-hub.github.io/imoveis-maceio/">Visitar site principal</a>' >> index.html
        echo '</p>' >> index.html
        echo '</div>' >> index.html
        
        echo '</div>' >> index.html
        echo '</body>' >> index.html
        echo '</html>' >> index.html
        
        echo "‚úÖ Relat√≥rio criado com sucesso!"
        echo "Total de linhas: $total_lines"
        echo "Total de arquivos: $total_files"
    
    - name: üì¶ Upload para GitHub Pages
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'
    
    - name: üöÄ Deploy
      uses: actions/deploy-pages@v4
    
    - name: üéâ Mostrar resultado
      run: |
        echo ""
        echo "üéâ RELAT√ìRIO CRIADO COM SUCESSO!"
        echo "================================"
        echo ""
        echo "‚úÖ Extra√ß√£o completa realizada"
        echo "‚úÖ Todas as linhas extra√≠das"
        echo "‚úÖ Sem limita√ß√µes de visualiza√ß√£o"
        echo ""
        echo "üåê Dispon√≠vel em:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìä Estat√≠sticas:"
        echo "- Linhas totais: $total_lines"
        echo "- Arquivos totais: $total_files"
        echo "- Extra√ß√£o: 100% completa"
