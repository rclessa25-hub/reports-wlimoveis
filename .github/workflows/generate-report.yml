name: üìä Gerar Relat√≥rio R√°pido

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: üì• Checkout
      uses: actions/checkout@v4
    
    - name: üîç Analisar projeto principal
      run: |
        echo "üî¨ ANALISANDO PROJETO IM√ìVEIS MACEI√ì..."
        echo "======================================="
        
        # Clonar projeto principal
        git clone https://github.com/rclessa25-hub/imoveis-maceio.git projeto 2>/dev/null || true
        
        cd projeto
        
        # Contar arquivos rapidamente
        HTML_COUNT=$(find . -name "*.html" -type f 2>/dev/null | wc -l || echo "0")
        CSS_COUNT=$(find . -name "*.css" -type f 2>/dev/null | wc -l || echo "0")
        JS_COUNT=$(find . -name "*.js" -type f 2>/dev/null | wc -l || echo "0")
        JSON_COUNT=$(find . -name "*.json" -type f 2>/dev/null | wc -l || echo "0")
        
        # Listar arquivos principais
        echo "üìÅ ARQUIVOS ENCONTRADOS:"
        find . -type f -name "*.html" -o -name "*.css" -o -name "*.js" | head -20
        
        # Salvar contagens
        echo "HTML_COUNT=$HTML_COUNT" >> $GITHUB_ENV
        echo "CSS_COUNT=$CSS_COUNT" >> $GITHUB_ENV
        echo "JS_COUNT=$JS_COUNT" >> $GITHUB_ENV
        echo "JSON_COUNT=$JSON_COUNT" >> $GITHUB_ENV
        
        echo "‚úÖ AN√ÅLISE CONCLU√çDA"
        echo "üìä HTML: $HTML_COUNT, CSS: $CSS_COUNT, JS: $JS_COUNT"
    
    - name: üìù Gerar relat√≥rio SIMPLES
      run: |
        echo "üìÑ GERANDO RELAT√ìRIO SIMPLES E R√ÅPIDO..."
        echo "========================================"
        
        DATE_NOW=$(date '+%d/%m/%Y √†s %H:%M:%S')
        
        # Criar HTML MUITO SIMPLES
        cat > index.html << HTML
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Relat√≥rio - Im√≥veis Macei√≥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 3px solid #2ea44f;
            margin-bottom: 30px;
        }
        h1 { color: #2ea44f; font-size: 2.5em; }
        h2 { color: #58a6ff; margin: 25px 0 15px; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            border-color: #2ea44f;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2ea44f;
            line-height: 1;
        }
        .stat-label {
            margin-top: 8px;
            color: #8b949e;
            font-size: 0.9em;
        }
        
        .info-box {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .links {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .links a {
            color: #58a6ff;
            text-decoration: none;
            padding: 10px 15px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
        }
        .links a:hover {
            background: #1f6feb;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>üìä Relat√≥rio Anal√≠tico</h1>
        <h2>Im√≥veis Macei√≥ - Sistema de Gest√£o de Im√≥veis</h2>
        <p><strong>Gerado em:</strong> $DATE_NOW</p>
    </header>
    
    <div class="links">
        <a href="#stats">üìà Estat√≠sticas</a>
        <a href="#info">‚ÑπÔ∏è Informa√ß√µes</a>
        <a href="https://rclessa25-hub.github.io/imoveis-maceio/" target="_blank">üåê Site Principal</a>
        <a href="https://github.com/rclessa25-hub/imoveis-maceio" target="_blank">üíæ Reposit√≥rio</a>
    </div>
    
    <section id="stats">
        <h2>üìà Estat√≠sticas do Projeto</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">${{ env.HTML_COUNT }}</div>
                <div class="stat-label">Arquivos HTML</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${{ env.CSS_COUNT }}</div>
                <div class="stat-label">Arquivos CSS</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${{ env.JS_COUNT }}</div>
                <div class="stat-label">Arquivos JavaScript</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${{ env.JSON_COUNT }}</div>
                <div class="stat-label">Arquivos JSON</div>
            </div>
        </div>
    </section>
    
    <section id="info">
        <h2>‚ÑπÔ∏è Informa√ß√µes do Projeto</h2>
        
        <div class="info-box">
            <h3>üìã Detalhes T√©cnicos</h3>
            <p><strong>URL:</strong> https://rclessa25-hub.github.io/imoveis-maceio/</p>
            <p><strong>Tecnologias:</strong> HTML5, CSS3, JavaScript, Supabase</p>
            <p><strong>Arquitetura:</strong> Frontend modular com componentes reutiliz√°veis</p>
            <p><strong>Banco de Dados:</strong> Supabase (PostgreSQL)</p>
            
            <h3>üîÑ Atualiza√ß√£o Autom√°tica</h3>
            <p>Este relat√≥rio √© atualizado:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Todo domingo √† meia-noite</li>
                <li>Manualmente via GitHub Actions</li>
                <li>Instantaneamente ap√≥s cada execu√ß√£o</li>
            </ul>
        </div>
        
        <div class="info-box">
            <h3>üéØ Funcionalidades Principais</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Cadastro e gest√£o de im√≥veis</li>
                <li>Painel administrativo</li>
                <li>Galeria de imagens</li>
                <li>Integra√ß√£o com banco de dados</li>
                <li>Interface responsiva</li>
            </ul>
        </div>
    </section>
    
    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #30363d; text-align: center; color: #8b949e;">
        <p><strong>Relat√≥rio gerado automaticamente por GitHub Actions</strong></p>
        <p>√öltima atualiza√ß√£o: $DATE_NOW</p>
        <div style="margin-top: 15px;">
            <a href="https://github.com/rclessa25-hub/reports-wlimoveis/actions" 
               style="color: #2ea44f; text-decoration: none;">
               üîÑ Executar an√°lise novamente
            </a>
        </div>
    </footer>
</body>
</html>
HTML
        
        # Criar tamb√©m um JSON com os dados
        cat > data.json << JSON
{
  "project": "Im√≥veis Macei√≥",
  "url": "https://rclessa25-hub.github.io/imoveis-maceio/",
  "generated_at": "$(date -Iseconds)",
  "stats": {
    "html_files": ${{ env.HTML_COUNT }},
    "css_files": ${{ env.CSS_COUNT }},
    "js_files": ${{ env.JS_COUNT }},
    "json_files": ${{ env.JSON_COUNT }}
  },
  "last_updated": "$(date '+%d/%m/%Y %H:%M:%S')"
}
JSON
        
        echo "‚úÖ Relat√≥rio gerado com sucesso!"
        echo "üìä Estat√≠sticas:"
        echo "HTML: ${{ env.HTML_COUNT }} | CSS: ${{ env.CSS_COUNT }}"
        echo "JS: ${{ env.JS_COUNT }} | JSON: ${{ env.JSON_COUNT }}"
    
    - name: üì¶ Upload para GitHub Pages
      uses: actions/upload-pages-artifact@v2
      with:
        path: '.'
    
    - name: üöÄ Deploy no GitHub Pages
      uses: actions/deploy-pages@v2
      id: deployment
    
    - name: üéâ Mostrar resultado
      run: |
        echo ""
        echo "üéâ RELAT√ìRIO PUBLICADO COM SUCESSO!"
        echo "==================================="
        echo ""
        echo "üåê URL DO RELAT√ìRIO:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìä DADOS COLETADOS:"
        echo "- Arquivos HTML: ${{ env.HTML_COUNT }}"
        echo "- Arquivos CSS: ${{ env.CSS_COUNT }}"
        echo "- Arquivos JavaScript: ${{ env.JS_COUNT }}"
        echo "- Arquivos JSON: ${{ env.JSON_COUNT }}"
        echo ""
        echo "‚ö° RELAT√ìRIO LEVE E R√ÅPIDO!"
        echo "‚úÖ Pronto para acesso imediato"
