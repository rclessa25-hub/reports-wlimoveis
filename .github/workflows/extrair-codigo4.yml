name: üì• Extrair C√≥digo Fonte Ver4 

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  extract-code:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    
    steps:
    - name: üì• Checkout
      uses: actions/checkout@v4
    
    - name: üì• Clonar projeto
      run: |
        git clone https://github.com/rclessa25-hub/imoveis-maceio.git fonte-completo
    
    - name: üìù Criar relat√≥rio completo
      run: |
        echo "üìä Iniciando extra√ß√£o com estat√≠sticas detalhadas..."
        
        # Data atual
        DATE_NOW=$(date '+%d/%m/%Y %H:%M:%S')
        
        # Iniciar arquivo HTML
        echo '<!DOCTYPE html>' > index.html
        echo '<html lang="pt-BR">' >> index.html
        echo '<head>' >> index.html
        echo '<meta charset="UTF-8">' >> index.html
        echo '<meta name="viewport" content="width=device-width, initial-scale=1.0">' >> index.html
        echo '<title>üìä C√≥digo Fonte COMPLETO com Estat√≠sticas</title>' >> index.html
        echo '<style>' >> index.html
        echo 'body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #0d1117; color: white; }' >> index.html
        echo '.container { max-width: 1400px; margin: 0 auto; }' >> index.html
        echo 'header { background: #161b22; padding: 30px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #30363d; text-align: center; }' >> index.html
        echo '.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }' >> index.html
        echo '.stat-card { background: #161b22; padding: 25px; border-radius: 10px; border: 1px solid #30363d; text-align: center; }' >> index.html
        echo '.stat-number { font-size: 2.5em; font-weight: bold; color: #58a6ff; margin: 10px 0; }' >> index.html
        echo '.files-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin: 30px 0; }' >> index.html
        echo '.file-card { background: #161b22; padding: 20px; border-radius: 10px; border: 1px solid #30363d; }' >> index.html
        echo '.file-card:hover { border-color: #58a6ff; }' >> index.html
        echo '.file-icon { font-size: 2em; margin-right: 10px; }' >> index.html
        echo '.file-info { margin: 15px 0; }' >> index.html
        echo '.info-line { margin: 8px 0; display: flex; justify-content: space-between; }' >> index.html
        echo '.badge { background: #238636; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.9em; }' >> index.html
        echo '.js-badge { background: #f1e05a; color: #000; }' >> index.html
        echo '.css-badge { background: #563d7c; }' >> index.html
        echo '.html-badge { background: #e34c26; }' >> index.html
        echo '.json-badge { background: #f1e05a; color: #000; }' >> index.html
        echo '.code-section { background: #0a0e14; padding: 25px; border-radius: 10px; margin: 25px 0; border: 1px solid #30363d; }' >> index.html
        echo 'pre { margin: 0; font-family: monospace; overflow-x: auto; }' >> index.html
        echo '.line { margin: 2px 0; }' >> index.html
        echo '.num { color: #6a737d; margin-right: 15px; }' >> index.html
        echo 'a { color: #58a6ff; text-decoration: none; }' >> index.html
        echo 'a:hover { text-decoration: underline; }' >> index.html
        echo '</style>' >> index.html
        echo '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">' >> index.html
        echo '</head>' >> index.html
        echo '<body>' >> index.html
        echo '<div class="container">' >> index.html
        
        # Cabe√ßalho
        echo '<header>' >> index.html
        echo '<h1><i class="fas fa-file-code"></i> C√≥digo Fonte COMPLETO</h1>' >> index.html
        echo '<p>Im√≥veis Macei√≥ - Relat√≥rio Anal√≠tico com Estat√≠sticas Detalhadas</p>' >> index.html
        echo "<p>Gerado em: $DATE_NOW</p>" >> index.html
        echo '</header>' >> index.html
        
        echo "üîç Calculando estat√≠sticas detalhadas..."
        
        # Procurar arquivos
        html_files=$(find fonte-completo -name "*.html" -type f)
        js_files=$(find fonte-completo -name "*.js" -type f)
        css_files=$(find fonte-completo -name "*.css" -type f)
        json_files=$(find fonte-completo -name "*.json" -type f)
        
        # Contagens
        html_count=$(echo "$html_files" | wc -l)
        js_count=$(echo "$js_files" | wc -l)
        css_count=$(echo "$css_files" | wc -l)
        json_count=$(echo "$json_files" | wc -l)
        
        total_files=$((html_count + js_count + css_count + json_count))
        
        # Estat√≠sticas gerais
        echo '<div class="stats-grid">' >> index.html
        
        # Total de linhas
        total_lines=0
        for file in $html_files $js_files $css_files $json_files; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
          fi
        done
        
        echo '<div class="stat-card">' >> index.html
        echo '<i class="fas fa-bars fa-2x"></i>' >> index.html
        echo '<div class="stat-number">'$total_lines'</div>' >> index.html
        echo '<p>Linhas de C√≥digo</p>' >> index.html
        echo '</div>' >> index.html
        
        # Total de arquivos
        echo '<div class="stat-card">' >> index.html
        echo '<i class="fas fa-file fa-2x"></i>' >> index.html
        echo '<div class="stat-number">'$total_files'</div>' >> index.html
        echo '<p>Arquivos</p>' >> index.html
        echo '</div>' >> index.html
        
        # Total de fun√ß√µes JavaScript
        total_js_functions=0
        for file in $js_files; do
          if [ -f "$file" ]; then
            # Contar fun√ß√µes
            functions=$(grep -c "function\|=>\|class " "$file" 2>/dev/null || echo "0")
            total_js_functions=$((total_js_functions + functions))
          fi
        done
        
        echo '<div class="stat-card">' >> index.html
        echo '<i class="fas fa-code fa-2x"></i>' >> index.html
        echo '<div class="stat-number">'$total_js_functions'</div>' >> index.html
        echo '<p>Fun√ß√µes JavaScript</p>' >> index.html
        echo '</div>' >> index.html
        
        # Tamanho total
        total_size=0
        for file in $html_files $js_files $css_files $json_files; do
          if [ -f "$file" ]; then
            size=$(wc -c < "$file")
            total_size=$((total_size + size))
          fi
        done
        total_size_kb=$((total_size / 1024))
        
        echo '<div class="stat-card">' >> index.html
        echo '<i class="fas fa-weight-hanging fa-2x"></i>' >> index.html
        echo '<div class="stat-number">'$total_size_kb'KB</div>' >> index.html
        echo '<p>Tamanho Total</p>' >> index.html
        echo '</div>' >> index.html
        
        echo '</div>' >> index.html
        
        # Lista detalhada de arquivos
        echo '<h2><i class="fas fa-folder-open"></i> Lista de Arquivos Extra√≠dos (COMPLETO)</h2>' >> index.html
        echo '<div class="files-grid">' >> index.html
        
        # Processar cada arquivo individualmente
        all_files="$html_files $js_files $css_files $json_files"
        
        for file_path in $all_files; do
          if [ -f "$file_path" ]; then
            filename=$(basename "$file_path")
            relative_path=${file_path#fonte-completo/}
            dir_path=$(dirname "$relative_path")
            lines=$(wc -l < "$file_path")
            size=$(wc -c < "$file_path")
            size_kb=$((size / 1024))
            
            # Determinar tipo e √≠cone
            if [[ "$filename" == *.html ]]; then
              icon="<i class='fas fa-globe file-icon'></i>"
              type="HTML"
              badge_class="html-badge"
              description="(P√°gina)"
            elif [[ "$filename" == *.js ]]; then
              icon="<i class='fas fa-file-code file-icon'></i>"
              type="JavaScript"
              badge_class="js-badge"
              
              # Detectar tipo de arquivo JS
              if [[ "$relative_path" == *"components"* ]]; then
                description="(Componente)"
              elif [[ "$relative_path" == *"modules"* ]]; then
                description="(M√≥dulo)"
              else
                description="(JavaScript)"
              fi
              
              # Contar fun√ß√µes neste arquivo JS
              functions=$(grep -c "function\|=>\|class " "$file_path" 2>/dev/null || echo "0")
            elif [[ "$filename" == *.css ]]; then
              icon="<i class='fas fa-paint-brush file-icon'></i>"
              type="CSS"
              badge_class="css-badge"
              description="(Estilo)"
            elif [[ "$filename" == *.json ]]; then
              icon="<i class='fas fa-cog file-icon'></i>"
              type="JSON"
              badge_class="json-badge"
              description="(Configura√ß√£o)"
            else
              icon="<i class='fas fa-file file-icon'></i>"
              type="Arquivo"
              badge_class=""
              description=""
            fi
            
            # Gerar ID √∫nico
            file_id=$(echo "$relative_path" | tr '/.' '_' | tr -cd '[:alnum:]_')
            
            echo '<div class="file-card">' >> index.html
            echo '<div style="display: flex; align-items: center; margin-bottom: 15px;">' >> index.html
            echo "$icon" >> index.html
            echo '<div>' >> index.html
            echo "<h3 style='margin: 0;'>$filename <span class='badge $badge_class'>$type</span></h3>" >> index.html
            echo "<p style='margin: 5px 0 0 0; color: #8b949e;'>$description</p>" >> index.html
            echo '</div>' >> index.html
            echo '</div>' >> index.html
            
            echo '<div class="file-info">' >> index.html
            echo '<div class="info-line">' >> index.html
            echo '<span><i class="fas fa-folder"></i> Local:</span>' >> index.html
            echo "<span>$dir_path</span>" >> index.html
            echo '</div>' >> index.html
            
            echo '<div class="info-line">' >> index.html
            echo '<span><i class="fas fa-bars"></i> Linhas:</span>' >> index.html
            echo "<span class='badge'>$lines</span>" >> index.html
            echo '</div>' >> index.html
            
            # Mostrar fun√ß√µes apenas para JS
            if [[ "$filename" == *.js ]]; then
              echo '<div class="info-line">' >> index.html
              echo '<span><i class="fas fa-code"></i> Fun√ß√µes:</span>' >> index.html
              echo "<span class='badge'>$functions</span>" >> index.html
              echo '</div>' >> index.html
            fi
            
            echo '<div class="info-line">' >> index.html
            echo '<span><i class="fas fa-weight-hanging"></i> Tamanho:</span>' >> index.html
            echo "<span class='badge'>${size_kb} KB</span>" >> index.html
            echo '</div>' >> index.html
            echo '</div>' >> index.html
            
            echo "<p style='text-align: center; margin-top: 15px;'>" >> index.html
            echo "<a href=\"#$file_id\"><i class='fas fa-eye'></i> Ver c√≥digo COMPLETO ‚Üí</a>" >> index.html
            echo '</p>' >> index.html
            echo '</div>' >> index.html
          fi
        done
        
        echo '</div>' >> index.html
        
        # C√≥digo completo dos arquivos
        echo '<h2><i class="fas fa-code"></i> C√≥digo Fonte Completo</h2>' >> index.html
        echo '<p>Todas as linhas de todos os arquivos:</p>' >> index.html
        
        for file_path in $all_files; do
          if [ -f "$file_path" ]; then
            filename=$(basename "$file_path")
            relative_path=${file_path#fonte-completo/}
            file_id=$(echo "$relative_path" | tr '/.' '_' | tr -cd '[:alnum:]_')
            lines=$(wc -l < "$file_path")
            
            # Determinar tipo
            if [[ "$filename" == *.html ]]; then
              file_type="HTML"
            elif [[ "$filename" == *.js ]]; then
              file_type="JavaScript"
            elif [[ "$filename" == *.css ]]; then
              file_type="CSS"
            elif [[ "$filename" == *.json ]]; then
              file_type="JSON"
            else
              file_type="Arquivo"
            fi
            
            echo "<div class='code-section' id='$file_id'>" >> index.html
            echo "<h3><i class='fas fa-file-alt'></i> $relative_path <span class='badge'>$lines linhas</span> <span class='badge'>$file_type</span></h3>" >> index.html
            echo '<pre>' >> index.html
            
            # Mostrar c√≥digo com numera√ß√£o
            line_num=1
            while IFS= read -r line; do
              # Escapar HTML b√°sico
              line=$(echo "$line" | sed 's/&/\&amp;/g')
              line=$(echo "$line" | sed 's/</\&lt;/g')
              line=$(echo "$line" | sed 's/>/\&gt;/g')
              line=$(echo "$line" | sed 's/"/\&quot;/g')
              
              echo "<div class='line'><span class='num'>$line_num</span>$line</div>" >> index.html
              line_num=$((line_num + 1))
            done < "$file_path"
            
            echo '</pre>' >> index.html
            echo "<p style='text-align: center; color: #3fb950;'><i class='fas fa-check-circle'></i> $lines linhas extra√≠das completamente</p>" >> index.html
            echo '</div>' >> index.html
          fi
        done
        
        # Resumo final
        echo '<div class="code-section" style="text-align: center; background: #161b22;">' >> index.html
        echo '<h3><i class="fas fa-chart-bar"></i> Resumo da Extra√ß√£o</h3>' >> index.html
        echo '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">' >> index.html
        
        echo '<div>' >> index.html
        echo '<h4>üìä Totais</h4>' >> index.html
        echo "<p>Linhas: $total_lines</p>" >> index.html
        echo "<p>Arquivos: $total_files</p>" >> index.html
        echo "<p>Tamanho: ${total_size_kb} KB</p>" >> index.html
        echo '</div>' >> index.html
        
        echo '<div>' >> index.html
        echo '<h4>‚ö° JavaScript</h4>' >> index.html
        echo "<p>Arquivos: $js_count</p>" >> index.html
        echo "<p>Fun√ß√µes: $total_js_functions</p>" >> index.html
        echo '</div>' >> index.html
        
        echo '<div>' >> index.html
        echo '<h4>üåê HTML</h4>' >> index.html
        echo "<p>Arquivos: $html_count</p>" >> index.html
        echo '</div>' >> index.html
        
        echo '<div>' >> index.html
        echo '<h4>üé® CSS</h4>' >> index.html
        echo "<p>Arquivos: $css_count</p>" >> index.html
        echo '</div>' >> index.html
        
        echo '</div>' >> index.html
        echo "<p><strong>Gerado em:</strong> $DATE_NOW</p>" >> index.html
        echo '<p>' >> index.html
        echo '<a href="https://rclessa25-hub.github.io/imoveis-maceio/"><i class="fas fa-external-link-alt"></i> Site Principal</a>' >> index.html
        echo '<span style="margin: 0 10px;">‚Ä¢</span>' >> index.html
        echo '<a href="https://github.com/rclessa25-hub/imoveis-maceio"><i class="fab fa-github"></i> Reposit√≥rio</a>' >> index.html
        echo '</p>' >> index.html
        echo '</div>' >> index.html
        
        echo '</div>' >> index.html
        echo '</body>' >> index.html
        echo '</html>' >> index.html
        
        echo "‚úÖ Relat√≥rio completo criado!"
        echo "üìä Estat√≠sticas:"
        echo "  ‚Ä¢ Linhas totais: $total_lines"
        echo "  ‚Ä¢ Arquivos: $total_files"
        echo "  ‚Ä¢ Fun√ß√µes JS: $total_js_functions"
        echo "  ‚Ä¢ Tamanho: ${total_size_kb}KB"
    
    - name: üì¶ Upload para GitHub Pages
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'
    
    - name: üöÄ Deploy
      uses: actions/deploy-pages@v4
    
    - name: üéâ Mostrar resultado final
      run: |
        echo ""
        echo "üéâ RELAT√ìRIO ANAL√çTICO COMPLETO!"
        echo "================================="
        echo ""
        echo "‚úÖ TODAS AS ESTAT√çSTICAS DETALHADAS"
        echo "‚úÖ FUN√á√ïES JAVASCRIPT CONTADAS"
        echo "‚úÖ LINHAS POR ARQUIVO"
        echo "‚úÖ TAMANHOS CALCULADOS"
        echo ""
        echo "üåê ACESSE EM:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìä O RELAT√ìRIO INCLUI AGORA:"
        echo "‚Ä¢ üìÅ Lista completa de arquivos"
        echo "‚Ä¢ üìè Linhas por arquivo"
        echo "‚Ä¢ ‚ö° Fun√ß√µes JavaScript por arquivo"
        echo "‚Ä¢ üì¶ Tamanho de cada arquivo"
        echo "‚Ä¢ üìç Localiza√ß√£o exata"
        echo "‚Ä¢ üìä Estat√≠sticas gerais"
        echo ""
        echo "‚úÖ VERS√ÉO FINAL CONCLU√çDA COM SUCESSO!"
