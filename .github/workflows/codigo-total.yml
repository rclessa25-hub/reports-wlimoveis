name: üìö C√≥digo Total

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  extract-all-code:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
    
    steps:
    - name: üì• Checkout
      uses: actions/checkout@v4
    
    - name: üì• Baixar TODO o c√≥digo fonte
      run: |
        echo "üìö BAIXANDO TODO O C√ìDIGO FONTE..."
        echo "================================="
        
        # Clonar o projeto COMPLETO
        git clone --depth 1 https://github.com/rclessa25-hub/imoveis-maceio.git codigo-total
        
        echo "‚úÖ Projeto baixado com sucesso!"
        echo "üìä Estat√≠sticas iniciais:"
        echo "------------------------"
        find codigo-total -type f -name "*.html" -o -name "*.js" -o -name "*.css" -o -name "*.json" -o -name "*.md" | xargs wc -l | tail -1
    
    - name: üìù Criar relat√≥rio COMPLETO
      run: |
        echo "üìÑ GERANDO RELAT√ìRIO COMPLETO..."
        echo "==============================="
        
        DATE_NOW=$(date '+%d/%m/%Y √†s %H:%M:%S')
        
        # Criar √≠ndice principal
        echo '<!DOCTYPE html>' > index.html
        echo '<html lang="pt-BR">' >> index.html
        echo '<head>' >> index.html
        echo '<meta charset="UTF-8">' >> index.html
        echo '<meta name="viewport" content="width=device-width, initial-scale=1.0">' >> index.html
        echo '<title>üìö C√≥digo Total - Im√≥veis Macei√≥</title>' >> index.html
        echo '<style>' >> index.html
        echo ':root {' >> index.html
        echo '    --primary: #2ea44f;' >> index.html
        echo '    --dark: #0d1117;' >> index.html
        echo '    --dark-light: #161b22;' >> index.html
        echo '    --light: #c9d1d9;' >> index.html
        echo '    --border: #30363d;' >> index.html
        echo '    --blue: #58a6ff;' >> index.html
        echo '    --yellow: #f1e05a;' >> index.html
        echo '    --orange: #e34c26;' >> index.html
        echo '    --purple: #563d7c;' >> index.html
        echo '}' >> index.html
        echo '* { margin: 0; padding: 0; box-sizing: border-box; }' >> index.html
        echo 'body {' >> index.html
        echo '    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;' >> index.html
        echo '    background: var(--dark);' >> index.html
        echo '    color: var(--light);' >> index.html
        echo '    line-height: 1.6;' >> index.html
        echo '}' >> index.html
        echo '.container { max-width: 1600px; margin: 0 auto; padding: 20px; }' >> index.html
        echo 'header {' >> index.html
        echo '    text-align: center;' >> index.html
        echo '    padding: 40px 0;' >> index.html
        echo '    border-bottom: 3px solid var(--primary);' >> index.html
        echo '    margin-bottom: 40px;' >> index.html
        echo '}' >> index.html
        echo 'h1 { color: var(--primary); font-size: 2.8em; margin-bottom: 10px; }' >> index.html
        echo 'h2 { color: var(--blue); margin: 40px 0 25px; padding-bottom: 15px; border-bottom: 2px solid var(--border); }' >> index.html
        echo 'h3 { color: var(--primary); margin: 30px 0 15px; font-size: 1.3em; }' >> index.html
        echo '.file-index {' >> index.html
        echo '    background: var(--dark-light);' >> index.html
        echo '    padding: 30px;' >> index.html
        echo '    border-radius: 12px;' >> index.html
        echo '    margin: 30px 0;' >> index.html
        echo '}' >> index.html
        echo '.file-grid {' >> index.html
        echo '    display: grid;' >> index.html
        echo '    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));' >> index.html
        echo '    gap: 20px;' >> index.html
        echo '    margin: 25px 0;' >> index.html
        echo '}' >> index.html
        echo '.file-item {' >> index.html
        echo '    background: rgba(255,255,255,0.05);' >> index.html
        echo '    border: 1px solid var(--border);' >> index.html
        echo '    border-radius: 10px;' >> index.html
        echo '    padding: 20px;' >> index.html
        echo '    transition: all 0.3s;' >> index.html
        echo '}' >> index.html
        echo '.file-item:hover { border-color: var(--primary); transform: translateY(-3px); }' >> index.html
        echo '.file-header {' >> index.html
        echo '    display: flex;' >> index.html
        echo '    align-items: center;' >> index.html
        echo '    gap: 15px;' >> index.html
        echo '    margin-bottom: 15px;' >> index.html
        echo '}' >> index.html
        echo '.file-icon.html { color: var(--orange); font-size: 1.5em; }' >> index.html
        echo '.file-icon.js { color: var(--yellow); font-size: 1.5em; }' >> index.html
        echo '.file-icon.css { color: var(--purple); font-size: 1.5em; }' >> index.html
        echo '.file-icon.json { color: var(--yellow); opacity: 0.8; font-size: 1.5em; }' >> index.html
        echo '.file-icon.md { color: var(--blue); font-size: 1.5em; }' >> index.html
        echo '.file-info { flex-grow: 1; }' >> index.html
        echo '.file-name { font-weight: bold; font-size: 1.2em; }' >> index.html
        echo '.file-path { color: #8b949e; font-size: 0.9em; font-family: monospace; }' >> index.html
        echo '.file-stats {' >> index.html
        echo '    display: flex;' >> index.html
        echo '    gap: 15px;' >> index.html
        echo '    margin-top: 10px;' >> index.html
        echo '    font-size: 0.9em;' >> index.html
        echo '}' >> index.html
        echo '.file-stat {' >> index.html
        echo '    background: rgba(46, 164, 79, 0.1);' >> index.html
        echo '    color: var(--primary);' >> index.html
        echo '    padding: 5px 10px;' >> index.html
        echo '    border-radius: 15px;' >> index.html
        echo '}' >> index.html
        echo '.file-link {' >> index.html
        echo '    display: inline-block;' >> index.html
        echo '    margin-top: 15px;' >> index.html
        echo '    color: var(--primary);' >> index.html
        echo '    text-decoration: none;' >> index.html
        echo '    font-weight: bold;' >> index.html
        echo '}' >> index.html
        echo '.file-link:hover { text-decoration: underline; }' >> index.html
        echo '.code-section {' >> index.html
        echo '    margin: 50px 0;' >> index.html
        echo '}' >> index.html
        echo '.code-header {' >> index.html
        echo '    display: flex;' >> index.html
        echo '    justify-content: space-between;' >> index.html
        echo '    align-items: center;' >> index.html
        echo '    margin-bottom: 20px;' >> index.html
        echo '    padding-bottom: 15px;' >> index.html
        echo '    border-bottom: 2px solid var(--border);' >> index.html
        echo '}' >> index.html
        echo '.code-container {' >> index.html
        echo '    background: #000;' >> index.html
        echo '    border-radius: 12px;' >> index.html
        echo '    overflow: hidden;' >> index.html
        echo '}' >> index.html
        echo '.code-toolbar {' >> index.html
        echo '    background: #161b22;' >> index.html
        echo '    padding: 15px 20px;' >> index.html
        echo '    border-bottom: 1px solid var(--border);' >> index.html
        echo '    display: flex;' >> index.html
        echo '    justify-content: space-between;' >> index.html
        echo '    align-items: center;' >> index.html
        echo '}' >> index.html
        echo '.code-toolbar .file-name { color: var(--light); }' >> index.html
        echo '.code-content {' >> index.html
        echo '    padding: 25px;' >> index.html
        echo '    overflow-x: auto;' >> index.html
        echo '    max-height: 800px;' >> index.html
        echo '    overflow-y: auto;' >> index.html
        echo '}' >> index.html
        echo '.code-line {' >> index.html
        echo '    display: flex;' >> index.html
        echo '    font-family: "Monaco", "Courier New", monospace;' >> index.html
        echo '    font-size: 0.95em;' >> index.html
        echo '    line-height: 1.5;' >> index.html
        echo '}' >> index.html
        echo '.line-number {' >> index.html
        echo '    color: #6a737d;' >> index.html
        echo '    min-width: 50px;' >> index.html
        echo '    text-align: right;' >> index.html
        echo '    padding-right: 15px;' >> index.html
        echo '    user-select: none;' >> index.html
        echo '    border-right: 1px solid #30363d;' >> index.html
        echo '}' >> index.html
        echo '.line-content {' >> index.html
        echo '    flex-grow: 1;' >> index.html
        echo '    padding-left: 15px;' >> index.html
        echo '    white-space: pre-wrap;' >> index.html
        echo '    word-break: break-all;' >> index.html
        echo '}' >> index.html
        echo '.comment { color: #6a737d; }' >> index.html
        echo '.string { color: #9ecbff; }' >> index.html
        echo '.keyword { color: #ff7b72; }' >> index.html
        echo '.function { color: #d2a8ff; }' >> index.html
        echo '.number { color: #79c0ff; }' >> index.html
        echo '.summary {' >> index.html
        echo '    background: var(--dark-light);' >> index.html
        echo '    padding: 30px;' >> index.html
        echo '    border-radius: 12px;' >> index.html
        echo '    margin: 40px 0;' >> index.html
        echo '    text-align: center;' >> index.html
        echo '}' >> index.html
        echo '.summary-stats {' >> index.html
        echo '    display: flex;' >> index.html
        echo '    justify-content: center;' >> index.html
        echo '    gap: 40px;' >> index.html
        echo '    margin: 25px 0;' >> index.html
        echo '    flex-wrap: wrap;' >> index.html
        echo '}' >> index.html
        echo '.summary-stat {' >> index.html
        echo '    text-align: center;' >> index.html
        echo '}' >> index.html
        echo '.summary-value {' >> index.html
        echo '    font-size: 2.5em;' >> index.html
        echo '    font-weight: bold;' >> index.html
        echo '    color: var(--primary);' >> index.html
        echo '    line-height: 1;' >> index.html
        echo '}' >> index.html
        echo 'footer {' >> index.html
        echo '    margin-top: 60px;' >> index.html
        echo '    padding-top: 30px;' >> index.html
        echo '    border-top: 2px solid var(--border);' >> index.html
        echo '    text-align: center;' >> index.html
        echo '    color: #8b949e;' >> index.html
        echo '}' >> index.html
        echo '@media (max-width: 768px) {' >> index.html
        echo '    .file-grid { grid-template-columns: 1fr; }' >> index.html
        echo '    .summary-stats { flex-direction: column; gap: 20px; }' >> index.html
        echo '}' >> index.html
        echo '</style>' >> index.html
        echo '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">' >> index.html
        echo '</head>' >> index.html
        echo '<body>' >> index.html
        echo '<div class="container">' >> index.html
        echo '<header>' >> index.html
        echo '<h1><i class="fas fa-code"></i> C√≥digo Total</h1>' >> index.html
        echo '<p>Im√≥veis Macei√≥ - Sistema Completo</p>' >> index.html
        echo '<p><strong>Gerado em:</strong> '"$DATE_NOW"'</p>' >> index.html
        echo '<p><small>Todo o c√≥digo fonte em um √∫nico relat√≥rio</small></p>' >> index.html
        echo '</header>' >> index.html
        
        # √çNDICE DE ARQUIVOS
        echo '<div class="file-index">' >> index.html
        echo '<h2><i class="fas fa-list"></i> √çndice de Arquivos</h2>' >> index.html
        echo '<div class="file-grid">' >> index.html
        
        # Processar TODOS os arquivos
        file_counter=0
        while IFS= read -r file; do
          if [ -f "$file" ]; then
            filename=$(basename "$file")
            extension="${filename##*.}"
            relative_path=${file#codigo-total/}
            
            # Determinar √≠cone e classe
            case $extension in
              "html") icon_class="html"; icon="üìÑ" ;;
              "js") icon_class="js"; icon="üìú" ;;
              "css") icon_class="css"; icon="üé®" ;;
              "json") icon_class="json"; icon="üìã" ;;
              "md") icon_class="md"; icon="üìù" ;;
              *) icon_class=""; icon="üìÅ" ;;
            esac
            
            # Estat√≠sticas
            lines=$(wc -l < "$file" 2>/dev/null || echo "0")
            size=$(wc -c < "$file" 2>/dev/null || echo "0")
            size_kb=$(( (size + 1023) / 1024 ))  # Arredondar para cima
            
            # Gerar ID √∫nico para o arquivo
            file_id="file-$file_counter"
            file_counter=$((file_counter + 1))
            
            echo '<div class="file-item">' >> index.html
            echo '<div class="file-header">' >> index.html
            echo '<div class="file-icon '"$icon_class"'">'"$icon"'</div>' >> index.html
            echo '<div class="file-info">' >> index.html
            echo '<div class="file-name">'"$filename"'</div>' >> index.html
            echo '<div class="file-path">'"$(dirname "$relative_path")"'/</div>' >> index.html
            echo '</div>' >> index.html
            echo '</div>' >> index.html
            echo '<div class="file-stats">' >> index.html
            echo '<span class="file-stat">'"$lines"' linhas</span>' >> index.html
            echo '<span class="file-stat">'"$size_kb"' KB</span>' >> index.html
            echo '</div>' >> index.html
            echo '<a href="#'"$file_id"'" class="file-link">Ver c√≥digo completo ‚Üí</a>' >> index.html
            echo '</div>' >> index.html
          fi
        done < <(find codigo-total -type f \( -name "*.html" -o -name "*.js" -o -name "*.css" -o -name "*.json" -o -name "*.md" \) | sort)
        
        echo '</div>' >> index.html
        echo '</div>' >> index.html
        
        # SE√á√ÉO DE C√ìDIGO COMPLETO
        echo '<div class="code-section">' >> index.html
        echo '<h2><i class="fas fa-file-code"></i> C√≥digo Completo</h2>' >> index.html
        
        # Processar e mostrar CADA arquivo COMPLETO
        file_counter=0
        total_lines_all=0
        
        while IFS= read -r file; do
          if [ -f "$file" ]; then
            filename=$(basename "$file")
            relative_path=${file#codigo-total/}
            file_id="file-$file_counter"
            file_counter=$((file_counter + 1))
            
            # Ler o arquivo COMPLETO
            lines_in_file=$(wc -l < "$file" 2>/dev/null || echo "0")
            total_lines_all=$((total_lines_all + lines_in_file))
            
            echo '<div id="'"$file_id"'" class="code-container">' >> index.html
            echo '<div class="code-toolbar">' >> index.html
            echo '<div class="file-name"><i class="fas fa-file"></i> '"$relative_path"'</div>' >> index.html
            echo '<div style="color: #8b949e;">'"$lines_in_file"' linhas</div>' >> index.html
            echo '</div>' >> index.html
            echo '<div class="code-content">' >> index.html
            
            # Mostrar TODO o conte√∫do, linha por linha
            line_number=1
            while IFS= read -r line; do
              # Escapar HTML
              line_escaped=$(echo "$line" | sed 's/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g')
              
              echo '<div class="code-line">' >> index.html
              echo '<div class="line-number">'"$line_number"'</div>' >> index.html
              echo '<div class="line-content">'"$line_escaped"'</div>' >> index.html
              echo '</div>' >> index.html
              
              line_number=$((line_number + 1))
            done < "$file"
            
            echo '</div>' >> index.html
            echo '</div>' >> index.html
            echo '<div style="height: 40px;"></div>' >> index.html  # Espa√ßo entre arquivos
          fi
        done < <(find codigo-total -type f \( -name "*.html" -o -name "*.js" -o -name "*.css" -o -name "*.json" -o -name "*.md" \) | sort)
        
        echo '</div>' >> index.html
        
        # RESUMO FINAL
        echo '<div class="summary">' >> index.html
        echo '<h2><i class="fas fa-chart-bar"></i> Resumo Total</h2>' >> index.html
        
        # Contagens
        total_files=$(find codigo-total -type f \( -name "*.html" -o -name "*.js" -o -name "*.css" -o -name "*.json" -o -name "*.md" \) | wc -l)
        html_files=$(find codigo-total -name "*.html" -type f | wc -l)
        js_files=$(find codigo-total -name "*.js" -type f | wc -l)
        css_files=$(find codigo-total -name "*.css" -type f | wc -l)
        json_files=$(find codigo-total -name "*.json" -type f | wc -l)
        md_files=$(find codigo-total -name "*.md" -type f | wc -l)
        
        echo '<div class="summary-stats">' >> index.html
        echo '<div class="summary-stat">' >> index.html
        echo '<div class="summary-value">'"$total_files"'</div>' >> index.html
        echo '<div>Arquivos</div>' >> index.html
        echo '</div>' >> index.html
        echo '<div class="summary-stat">' >> index.html
        echo '<div class="summary-value">'"$total_lines_all"'</div>' >> index.html
        echo '<div>Linhas</div>' >> index.html
        echo '</div>' >> index.html
        echo '<div class="summary-stat">' >> index.html
        echo '<div class="summary-value">'"$html_files"'</div>' >> index.html
        echo '<div>HTML</div>' >> index.html
        echo '</div>' >> index.html
        echo '<div class="summary-stat">' >> index.html
        echo '<div class="summary-value">'"$js_files"'</div>' >> index.html
        echo '<div>JavaScript</div>' >> index.html
        echo '</div>' >> index.html
        echo '<div class="summary-stat">' >> index.html
        echo '<div class="summary-value">'"$css_files"'</div>' >> index.html
        echo '<div>CSS</div>' >> index.html
        echo '</div>' >> index.html
        echo '</div>' >> index.html
        
        echo '<p><strong>Sistema:</strong> Im√≥veis Macei√≥ - Gest√£o Imobili√°ria</p>' >> index.html
        echo '<p><strong>Arquitetura:</strong> Frontend Modular com Supabase</p>' >> index.html
        echo '<p><strong>Status:</strong> <span style="color: var(--primary);">‚óè Em produ√ß√£o</span></p>' >> index.html
        echo '<p><strong>URL:</strong> <a href="https://rclessa25-hub.github.io/imoveis-maceio/" style="color: var(--primary);">Site Principal</a></p>' >> index.html
        echo '</div>' >> index.html
        
        # FOOTER
        echo '<footer>' >> index.html
        echo '<p><strong>üìö C√≥digo Total - Documenta√ß√£o Completa</strong></p>' >> index.html
        echo '<p>Extra√≠do automaticamente em '"$DATE_NOW"'</p>' >> index.html
        echo '<div style="margin-top: 20px;">' >> index.html
        echo '<a href="https://rclessa25-hub.github.io/imoveis-maceio/" style="color: var(--primary); margin: 0 15px;">' >> index.html
        echo '<i class="fas fa-external-link-alt"></i> Site em Produ√ß√£o' >> index.html
        echo '</a>' >> index.html
        echo '<a href="https://github.com/rclessa25-hub/imoveis-maceio" style="color: var(--primary); margin: 0 15px;">' >> index.html
        echo '<i class="fab fa-github"></i> Reposit√≥rio' >> index.html
        echo '</a>' >> index.html
        echo '</div>' >> index.html
        echo '</footer>' >> index.html
        
        echo '</div>' >> index.html
        
        # SCRIPT PARA MELHORAR VISUALIZA√á√ÉO
        echo '<script>' >> index.html
        echo '// Destacar sintaxe' >> index.html
        echo 'function highlightSyntax() {' >> index.html
        echo '    const codeContents = document.querySelectorAll(".line-content");' >> index.html
        echo '    const jsKeywords = ["function", "const", "let", "var", "class", "import", "export", "async", "await", "return", "if", "else", "for", "while", "try", "catch", "throw", "new", "this", "typeof", "instanceof"];' >> index.html
        echo '    ' >> index.html
        echo '    codeContents.forEach(content => {' >> index.html
        echo '        let html = content.innerHTML;' >> index.html
        echo '        ' >> index.html
        echo '        // Destacar coment√°rios' >> index.html
        echo '        html = html.replace(/\/\/.*$/gm, \'<span class="comment">$&</span>\');' >> index.html
        echo '        html = html.replace(/\/\*[\s\S]*?\*\//gm, \'<span class="comment">$&</span>\');' >> index.html
        echo '        ' >> index.html
        echo '        // Destacar strings' >> index.html
        echo '        html = html.replace(/"[^"]*"/g, \'<span class="string">$&</span>\');' >> index.html
        echo '        html = html.replace(/\'[^\']*\'/g, \'<span class="string">$&</span>\');' >> index.html
        echo '        ' >> index.html
        echo '        // Destacar n√∫meros' >> index.html
        echo '        html = html.replace(/\b\d+\b/g, \'<span class="number">$&</span>\');' >> index.html
        echo '        ' >> index.html
        echo '        // Destacar palavras-chave JavaScript' >> index.html
        echo '        jsKeywords.forEach(keyword => {' >> index.html
        echo '            const regex = new RegExp(`\\\\b${keyword}\\\\b`, "g");' >> index.html
        echo '            html = html.replace(regex, `<span class="keyword">${keyword}</span>`);' >> index.html
        echo '        });' >> index.html
        echo '        ' >> index.html
        echo '        // Destacar fun√ß√µes' >> index.html
        echo '        html = html.replace(/(\\w+)\\s*\\(/g, \'<span class="function">$1</span>(\');' >> index.html
        echo '        ' >> index.html
        echo '        content.innerHTML = html;' >> index.html
        echo '    });' >> index.html
        echo '}' >> index.html
        echo '' >> index.html
        echo '// Executar quando a p√°gina carregar' >> index.html
        echo 'document.addEventListener("DOMContentLoaded", highlightSyntax);' >> index.html
        echo '' >> index.html
        echo '// Navega√ß√£o suave para os links' >> index.html
        echo 'document.querySelectorAll("a[href^=\'#\']").forEach(anchor => {' >> index.html
        echo '    anchor.addEventListener("click", function(e) {' >> index.html
        echo '        e.preventDefault();' >> index.html
        echo '        const targetId = this.getAttribute("href");' >> index.html
        echo '        const targetElement = document.querySelector(targetId);' >> index.html
        echo '        if (targetElement) {' >> index.html
        echo '            window.scrollTo({' >> index.html
        echo '                top: targetElement.offsetTop - 100,' >> index.html
        echo '                behavior: "smooth"' >> index.html
        echo '            });' >> index.html
        echo '        }' >> index.html
        echo '    });' >> index.html
        echo '});' >> index.html
        echo '</script>' >> index.html
        echo '</body>' >> index.html
        echo '</html>' >> index.html
        
        echo "‚úÖ Relat√≥rio COMPLETO gerado!"
        echo ""
        echo "üìä ESTAT√çSTICAS FINAIS:"
        echo "======================="
        echo "Total de arquivos: $total_files"
        echo "Total de linhas: $total_lines_all"
        echo "HTML: $html_files arquivos"
        echo "JavaScript: $js_files arquivos"
        echo "CSS: $css_files arquivos"
    
    - name: üì¶ Upload para GitHub Pages
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'
    
    - name: üöÄ Deploy
      uses: actions/deploy-pages@v4
    
    - name: üéâ Mostrar resultado
      run: |
        echo ""
        echo "üéâ C√ìDIGO TOTAL PUBLICADO!"
        echo "=========================="
        echo ""
        echo "üåê ACESSE EM:"
        echo "https://rclessa25-hub.github.io/reports-wlimoveis/"
        echo ""
        echo "üìö AGORA COM:"
        echo "1. üìÑ TODOS os arquivos COMPLETOS"
        echo "2. üìú TODO o c√≥digo SEM LIMITES"
        echo "3. üé® Destaque de sintaxe autom√°tico"
        echo "4. üìä Estat√≠sticas reais"
        echo "5. üîó Navega√ß√£o entre arquivos"
